# SmartStockLight 燈光指南

## 🎨 燈光顏色說明

### 🟡 黃燈（常態監控）
- **意義**：系統正常運作中，持續監控股價
- **亮度**：100%（正常）或 1%（睡眠待命模式）
- **觸發條件**：股價未達到目標價格時的預設狀態

### 🟢 綠燈（目標達成）
- **意義**：股價已達到您設定的目標價格！
- **亮度**：100%（全亮）
- **觸發條件**：
  - **漲破模式**：當前價格 ≥ 目標價格
  - **跌破模式**：當前價格 ≤ 目標價格
- **警報行為**：
  - 燈光立即轉為綠色（即使在睡眠待命模式也會亮起）
  - 啟動持續語音播報（每10秒一次）
  - 播報內容包含確切的股票代號和價格
  - 需手動點擊「停止警報播報」按鈕才會停止

**範例播報內容**：
> "緊急警報！虛擬貨幣 B T C 目前價格 88000.00 美元，已達到您設定的目標價格 88000.00 美元。請立即查看。"

### 🔴 紅燈（停損警報 / 系統異常）
- **意義**：股價跌破停損價，或系統無法取得數據
- **亮度**：100%（全亮）
- **觸發條件**：
  1. **停損觸發**：當前價格 ≤ 停損價格
  2. **數據異常**：無法從 yfinance 獲取股價資料
- **警報行為**：
  - 燈光立即轉為紅色
  - 語音播報停損警告
  - 提示用戶注意風險

### 🟣 紫燈（閃崩警報）
- **意義**：偵測到股價在短時間內急劇下跌（恐慌性拋售）
- **亮度**：100%（全亮）
- **觸發條件**：
  - **時間窗口**：最近 1 分鐘內
  - **跌幅門檻**：≥ 1.5%
  - **數據要求**：至少需要 3 個價格數據點
  - **數據清洗**：自動過濾異常跳變（單次變動 > 50%）
- **警報行為**：
  - 燈光立即轉為紫色（即使在睡眠待命模式也會亮起）
  - 語音播報閃崩警告
  - 播報實際跌幅百分比

**範例播報內容**：
> "警告，Bitcoin USD 偵測到恐慌性閃崩，目前跌幅百分之 2.3。"

## 🛏️ 睡眠待命模式

點擊「睡眠待命（0流明）」按鈕後：
- 燈光調暗至 **1% 亮度**（黃色）
- 幾乎看不見光線，不會影響睡眠
- **系統持續監控**股價變化
- 一旦觸發警報（綠燈/紫燈/紅燈），燈光會立即調至 100% 亮度並播報

## 🔔 警報播報機制

### 持續播報
- 達到目標價格時，系統會**持續播報**（每10秒一次）
- 播報內容包含：
  - 股票代號（逐字母拼讀，如 "B T C"）
  - 股票名稱（如 "Bitcoin USD"）
  - 當前價格
  - 您設定的目標價格

### 停止播報
- 點擊網頁上的 **🔕 停止警報播報** 按鈕
- 播報立即停止
- 燈光恢復為黃色監控狀態

## 📊 閃崩偵測技術細節

系統使用滑動窗口演算法偵測閃崩：

1. **價格歷史記錄**：保留最近 5 分鐘的價格數據
2. **異常值過濾**：自動排除單次跳變超過 50% 的異常數據
3. **實時計算**：每 10 秒計算最近 1 分鐘的跌幅
4. **觸發條件**：
   ```
   跌幅 = (1分鐘前價格 - 當前價格) / 1分鐘前價格
   if 跌幅 >= 1.5% and 數據點 >= 3:
       觸發紫燈閃崩警報
   ```

## 💡 使用建議

- **日間監控**：使用正常黃燈模式（100% 亮度）
- **夜間睡眠**：使用睡眠待命模式（1% 亮度）
- **重要時刻**：設定停損價格，避免損失擴大
- **閃崩防護**：系統自動偵測，無需額外設定
